console.log("This site was generated by Hugo.");

// 处理脚注的返回链接
document.addEventListener("DOMContentLoaded", function () {

  // 修复可能存在的 ID 问题
  fixFootnoteIds();

  // 查找所有脚注返回链接
  const backRefs = document.querySelectorAll(".footnote-backref");

  if (backRefs.length > 0) {
    backRefs.forEach((backref, index) => {
      // 获取返回链接的 href
      const href = backref.getAttribute("href");
      if (!href) return;

      // 使返回链接更明显
      backref.style.fontWeight = "bold";
      backref.style.fontSize = "1.2em";

      // 为每个返回链接添加点击事件
      backref.addEventListener("click", function (e) {
        e.preventDefault();
        const targetId = href.substring(1); // 移除 # 符号
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          // 滚动到引用位置
          targetElement.scrollIntoView({ behavior: "smooth" });

          // 添加突出显示效果
          targetElement.classList.add("footnote-highlight");
          setTimeout(() => {
            targetElement.classList.remove("footnote-highlight");
          }, 2000);
        }
      });
    });
  }

  // 处理从文章到脚注的链接
  const footnoteRefs = document.querySelectorAll(".footnote-ref");

  if (footnoteRefs.length > 0) {
    footnoteRefs.forEach((ref, index) => {
      const href = ref.getAttribute("href");

      ref.addEventListener("click", function (e) {
        e.preventDefault();
        const targetId = this.getAttribute("href").substring(1);
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          targetElement.scrollIntoView({ behavior: "smooth" });
        }
      });
    });
  }
});

// 修复脚注 ID 相关问题
function fixFootnoteIds() {
  // 检查并修复脚注引用 ID
  const footnoteRefs = document.querySelectorAll('sup[id^="fnref"]');
  footnoteRefs.forEach((ref) => {
    const id = ref.id;
    const link = ref.querySelector("a");
    if (link) {
      const href = link.getAttribute("href");
      if (href) {
        // 确保链接指向正确的脚注
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // 确保脚注返回链接指向正确的引用
          const backref = target.querySelector(".footnote-backref");
          if (backref) {
            backref.setAttribute("href", "#" + id);
            console.log(
              `修复脚注返回链接: ${backref.getAttribute("href")} 指向 ${id}`
            );
          }
        }
      }
    }
  });
}
